{% extends "base.html" %}
{% block title %}流程审批申请 - 管理平台{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="page-header">
                <h1>流程审批申请</h1>
            </div>
            
            {% if current_user.is_authenticated %}
            <!-- 提交流程审批表单 -->
            <div class="card mb-6">
                <div class="card-header">
                    <h3 class="card-title">提交新流程审批申请</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('approvals') }}">
                        <div class="form-group">
                            <label for="approval_type">审批类型</label>
                            <select class="form-control" id="approval_type" name="approval_type">
                                <option value="">请选择审批类型</option>
                                <option value="airline_application">航司申请</option>
                                <option value="employment_application">入职申请</option>
                                <option value="other">其他</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="content">审批内容</label>
                            <textarea class="form-control" id="content" name="content" rows="5" placeholder="请详细描述您的申请内容"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="qq_number">QQ号</label>
                            <input type="text" class="form-control" id="qq_number" name="qq_number" placeholder="请输入您的QQ号" min="10000" pattern="[0-9]+" oninput="this.value = this.value.replace(/[^0-9]/g, '');" style="-moz-appearance: textfield;">
                            <style>
                                #qq_number::-webkit-inner-spin-button,
                                #qq_number::-webkit-outer-spin-button {
                                    -webkit-appearance: none;
                                    margin: 0;
                                }
                            </style>
                            <small class="form-text text-muted">提示：QQ号必须为数字，且不能包含非数字字符</small>
                        </div>
                        <div class="alert alert-info mb-4">
                            <strong>提示：</strong>审批申请后请在QQ与无名（QQ号：2122927071）联系
                        </div>
                        <button type="submit" class="btn btn-primary">提交审批申请</button>
                    </form>
                </div>
            </div>
            {% endif %}
            
            <!-- 审批列表 -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">我的审批申请列表</h3>
                </div>
                <div class="card-body">
                    {% if approvals %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>类型</th>
                                    <th>状态</th>
                                    <th>提交时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for approval in approvals %}
                                <tr>
                                    <td>{{ approval.id }}</td>
                                    <td>
                                        {% if approval.approval_type == 'airline_application' %}航司申请
                                        {% elif approval.approval_type == 'employment_application' %}入职申请
                                        {% else %}其他
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if approval.status == 'pending' %}
                                        <span class="badge badge-warning">待审批</span>
                                        {% elif approval.status == 'approved' %}
                                        <span class="badge badge-success">已批准</span>
                                        {% elif approval.status == 'rejected' %}
                                        <span class="badge badge-danger">已拒绝</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ approval.created_at }}</td>
                                    <td>
                                        <a href="{{ url_for('approval_details', approval_id=approval.id) }}" class="btn btn-info btn-sm">查看详情</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        {% if current_user.is_authenticated %}
                        您还没有提交过流程审批申请
                        {% else %}
                        请先登录后查看流程审批申请
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}